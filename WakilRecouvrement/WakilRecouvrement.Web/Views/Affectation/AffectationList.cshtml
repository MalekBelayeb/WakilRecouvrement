@model WakilRecouvrement.Domain.Entities.Formulaire

@{
    ViewBag.Title = "";
}

<h2>Traiter les affectations</h2>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
<link href="~/Content/datableHover.css" rel="stylesheet" />

<link href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" rel="stylesheet" />

<script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>

<script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js">
</script>
<script src="https://cdn.datatables.net/plug-ins/1.10.15/dataRender/datetime.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>

<h5><strong> @ViewBag.affectationRestant </strong> / <strong>@ViewBag.totalAffectation</strong> Affectations </h5>

<br />

<div class="row">
    <div class="col-xs-3">

        @Html.DropDownList("numLot", ViewData["list"] as SelectList, new { @class = "form-control" })

    </div>

    <div class="col-xs-3 col-md-5">


        @Html.DropDownList("traite", ViewBag.TraiteList as SelectList, new { @class = "form-control" })

    </div>
</div>

<br />

<table id="demodata" class="table table-striped table-bordered dt-responsive nowrap">
    <thead>
        <tr>

            <th>Affecté Le</th>
            <th>NumClient</th>
            <th>NumLot</th>
            <th>Compte</th>
            <th>IDClient</th>
            <th>NomClient</th>
            <th>TelPortable</th>
            <th>TelFixe</th>
            <th>Solde debiteur</th>
            <th>Agence</th>
            <th>Adresse</th>
            <th>Type</th>
            <th>Numero</th>
            <th>AffId</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>



<script>


    $(document).ready(function () {
        $.noConflict();
        var Table = DemoDatatable();


        $("#numLot").change(function () {

              Table = DemoDatatable();

        })

        $("#traite").change(function () {

            Table = DemoDatatable();

        })


        $('#demodata tbody').on('click', 'td', function () {

             redirectToRoute(Table.row(this).data()["AffectationId"])

        });




    });

    function redirectToRoute(id)
    {
         $.ajax({
         type: 'POST',
         url: '@Url.Action("CreerFormulaireIntermediate", "Formulaire")',
         dataType: 'json',
             data: { id: id },
             success: function (data) {

                 window.location.replace(data.redirectUrl);

             }
         });
    }
    function DemoDatatable() {


        var table =  $("#demodata").DataTable({
            "processing": true,
            "serverSide": true,
            "filter": true,
            "orderMulti": false,
            "destroy": true,
            "ordering": true,
            "ajax": {
                "url": '@Url.Action("LoadData", "Affectation")',
                "type": "POST",
                "datatype": "json",
                "data": { numLot: $("#numLot").val(), traite: $("#traite").val() }
            },
            "columns": [
                { "data": "V", "name": "V", "autoWidth": true}
                , { "data": "LotId", "name": "LotId", "autoWidth": true }
                , { "data": "NumLot", "name": "NumLot", "autoWidth": true }
                , { "data": "Compte", "Name": "Compte", "autoWidth": true }
                , { "data": "IDClient", "name": "IDClient", "autoWidth": true }
                , { "data": "NomClient", "name": "NomClient", "autoWidth": true }
                , { "data": "TelPortable", "name": "TelPortable", "autoWidth": true }
                , { "data": "TelFixe", "name": "TelFixe", "autoWidth": true }
                , { "data": "SoldeDebiteur", "name": "SoldeDebiteur", "autoWidth": true }
                , { "data": "DescIndustry", "name": "DescIndustry", "autoWidth": true }
                , { "data": "Adresse", "name": "Adresse", "autoWidth": true }
                , { "data": "Type", "name": "Type", "autoWidth": true }
                , { "data": "Numero", "name": "Numero", "autoWidth": true }
                , { "data": "AffectationId", "name": "AffectationId", "autoWidth": true }
            ]
        });

        table.columns([13]).visible(false)

        return table;
    }

</script>

@{
    ViewBag.Title = "";
}

<h2>Traitement(s) prêt pour l'envoi ( <span><strong id="nbTotal"></strong></span> )</h2>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />

<link href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" rel="stylesheet" />

<script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>

<script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js">
</script>
<div class="col-xs-3">

    @Html.DropDownList("numLot", ViewData["list"] as SelectList, new { @class = "form-control" })

</div>

<br />

<div class="col-xs-3 ">


    @Html.DropDownList("traite", ViewBag.TraiteList as SelectList, new { @class = "form-control" })

</div>
<br />
<button id="Envoyer" type="button" class="btn btn-success">Envoyer</button>
<br />


<br />
<br />
<table id="demodata" class="table table-striped table-bordered dt-responsive nowrap">
    <thead>
        <tr>

            <th>NumLot</th>
            <th>Compte </th>
            <th>IDClient</th>
            <th>NomClient</th>
            <th>Etat</th>

        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<script>

    $(document).ready(function () {
        $.noConflict();

        var Table = DemoDatatable();

        $("#numLot").change(function () {

            Table = DemoDatatable(false);

        })

        $("#traite").change(function () {

            Table = DemoDatatable(false);

        })

        $("#Envoyer").click(function () {



            Table = DemoDatatable(true);

        })





    });


    function DemoDatatable(send) {
        var table = $("#demodata").DataTable({


            "processing": true,
            "serverSide": true,
            "filter": true,
            "orderMulti": false,
            "destroy": true,
            "ordering": true,
            "ajax": {
                "url": '/Formulaire/EnvoyerBanqueLoadData',
                "type": "POST",
                "datatype": "json",
                "data": { numLot: $("#numLot").val(), traite: $("#traite").val(), send: send }

            },
            "columns": [

                  { "data": "NumLot", "name": "NumLot", "autoWidth": true }
                , { "data": "Compte", "name": "Compte", "autoWidth": true }
                , { "data": "IDClient", "name": "IDClient", "autoWidth": true }
                , { "data": "NomClient", "name": "NomClient", "autoWidth": true }
                , { "data": "Etat", "name": "Etat", "autoWidth": true }

            ]
        });

        table.on('xhr.dt',
            function (e, settings, data, xhr) {
                console.log(data["info"])
                document.getElementById("nbTotal").innerHTML = data["info"]["nbTotal"]
            });
        return table;
    }

</script>
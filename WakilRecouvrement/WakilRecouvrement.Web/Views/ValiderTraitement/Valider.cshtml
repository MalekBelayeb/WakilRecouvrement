@model PagedList.IPagedList<WakilRecouvrement.Web.Models.ViewModel.ValiderTraitementViewModel>
@using PagedList.Mvc;

<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />

<script src="~/adminlte/plugins/jquery/jquery.min.js"></script>
<script src="~/adminlte/plugins/jquery-ui/jquery-ui.min.js"></script>

<script src="~/Scripts/bootstrap.js"></script>

<link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />


<link href="~/Content/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/responsive.bootstrap.min.css" rel="stylesheet" />

<script src="~/Scripts/jquery.dataTables.min.js"></script>

<script src="~/Scripts/dataTables.bootstrap4.min.js"></script>

<script src="~/adminlte/plugins/ekko-lightbox/ekko-lightbox.js"></script>
<link rel="stylesheet" href="~/adminlte/plugins/ekko-lightbox/ekko-lightbox.css" />


<div class="card">
    <div class="card-header" id="headingTwo">

        <h2>Valider Les Traitements</h2>

    </div>

    <div class="card-body">

        @using (Html.BeginForm("Valider", "ValiderTraitement", FormMethod.Post, new { onsubmit = "showLoading()" }))
        {

        <div class="row">

            <div class="col-xs-3  col-md-3">

                @Html.Label("traite", "Etat:", new { @class = "control-label" })

                @Html.DropDownList("traite", ViewBag.TraiteList as SelectList, new { @class = "form-control", currentFilter = ViewBag.currentTraite })

            </div>

            <div class="col-xs-3  col-md-3">


                @Html.Label("numLot", "Lot:", new { @class = "control-label " })

                @Html.DropDownList("numLot", ViewData["list"] as SelectList, new { @class = "form-control", currentFilter = ViewBag.currentNumLot })

            </div>
            <div class="col-xs-3  col-md-3">

                @Html.Label("agent", "Agent:", new { @class = "control-label " })

                @Html.DropDownList("agent", ViewBag.AgentList as SelectList, new { @class = "form-control", currentFilter = ViewBag.currentAgent })

            </div>
            <div class="col-xs-3 col-md-3">

                @Html.Label("SearchString", "Chercher:", new { @class = "control-label " })

                @Html.TextBox("SearchString", ViewBag.currentFilter as string, new { @class = "form-control" })

            </div>

            <br />

        </div>

        <br />
            <div class="row">

                <div class="col-xs-3 col-md-3">

                    <p>
                        <input id="submitBtn" type="submit" class="btn btn-primary" value="Chercher" />

                        <button style="display:none" id="submitLoading" class="btn btn-primary" type="button" disabled>
                            <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                            <span class="sr-only">Loading...</span>
                        </button>
                    </p>

                </div>


            </div>

        }
    </div>
    <div class="card-footer text-muted">
        <span>
            Total:
        </span>
        <span><strong> @ViewBag.total </strong></span>

    </div>
    <span id="page" hidden></span>
</div>

@using (Html.BeginForm("UploadVerifier", "ValiderTraitementVerifieFromExcel", FormMethod.Post, new { enctype = "multipart/form-data", onsubmit = "ExcelVerifierShowLoader()" }))
{

    @Html.AntiForgeryToken()

    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

    <div id="importFile" style="display:none">

        <div class="custom-file">
            <br />
            <input type="file" name="postedFile" class="custom-file-input" id="customFileLang" lang="es">
            <label class="custom-file-label" for="customFileLang">Importer votre fichier</label>

        </div>

        <div class="row row-list">
            <div class="col-xs-3">

                <div id="sumbitVerifierExcelBtn" class="form-group">
                    <div class="col-md-offset-2 col-md-10">
                        <input type="submit" value="Importer" class="btn btn-default" />
                    </div>
                </div>

            </div>
            <div class="col-xs-2 container-img">

                <div style="display:none" id="loader" class="spinner-border text-primary" role="status">
                    <span class="sr-only">Loading...</span>
                </div>

            </div>

            @if (ViewBag.messageFromExcelVerifier != null)
            {

                if (ViewBag.messageFromExcelVerifier != "")
                {

                    <p id="errormessage" >

                        @ViewBag.messageFromExcelVerifier

                    </p>
                }

            }

        </div>

        <br />
        <br />
    </div>

}

<table id="demodata" class="table table-striped table-bordered dt-responsive nowrap">
    <thead>
        <tr>

            <th></th>
            <th>Num Lot</th>
            <th>Etat Client</th>
            <th>Montant Versé/Déclaré </th>
            <th>Note</th>

            <th>Traité le:</th>
            <th>Agent</th>
            <th>Solde débiteur</th>
            <th>Compte</th>
            <th>IDClient</th>
            <th>NomClient</th>
            <th>Agence</th>

        </tr>
    </thead>
    <tbody>


        @foreach (var item in Model)
        {



<tr>
    <td>

        @Html.ActionLink("Vérifier", "TraiterDetail", "ValiderTraitementDetail", new
   {
       @class = "btn btn-default",
       idaffectation = item.AffectationId,
       idformulaire = item.FormulaireId

   }, null)


    </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Lot.NumLot)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Etat)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.MontantVerseDeclare)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.descAutre)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.TraiteLe)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Username)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Lot.SoldeDebiteur)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Lot.Compte)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Lot.IDClient)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Lot.NomClient)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Lot.DescIndustry)
                </td>

            </tr>

        }


    </tbody>
</table>


<span id="LocalStorage" style="visibility:hidden"></span>

<script>

    var traite = document.getElementById("traite")
    var importFile = document.getElementById("importFile")
    var errormessage = document.getElementById("errormessage")

    
    if (traite.value == "A_VERIFIE" ) {

        importFile.style.display = "block"

    } else {

        importFile.style.display = "none"

        if (errormessage == null) {

            importFile.style.display = "none"

        } else {
            if (errormessage.value == "") {

                importFile.style.display = "none"

            } else {

                importFile.style.display = "block"

            }
        }
        

    }

    

    traite.onchange = function () {
        console.log(traite.value)

        if (traite.value == "A_VERIFIE") {

            importFile.style.display = "block"

        } else {

            importFile.style.display = "none"
        }

    }


    function showLoading() {

        document.getElementById("submitLoading").style.display = "block";
        document.getElementById("submitBtn").style.display = "none";

    }

    function ExcelVerifierShowLoader() {

        document.getElementById("loader").style.display = "block";
        document.getElementById("sumbitVerifierExcelBtn").style.display = "none";

    }

    


</script>

<br />

Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount

@Html.PagedListPager(Model, page => Url.Action("Valider",
    new { page, currentPage = ViewBag.page, currentFilter = ViewBag.currentFilter, currentNumLot = ViewBag.currentNumLot, currentTraite = ViewBag.currentTraite, currentAgent = ViewBag.currentAgent }))